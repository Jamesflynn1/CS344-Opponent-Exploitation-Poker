#from Opponents.Uniform import Uniform_Opponent
from open_spiel.python import policy

from OpponentEV import compute_EV
import pandas as pd
import pyspiel
import StoreTabularPolicy


FL_game = 'leduc_poker'
FL_iterations = 2
FL_players = 2

game = pyspiel.load_game(FL_game, {"players": FL_players})
random_strategy = policy.UniformRandomPolicy(game)
cfr_strategy = StoreTabularPolicy.load_tabular_policy("Policy/Informed_Action.csv", game)
bps_strategy = StoreTabularPolicy.load_tabular_policy("Policy/Blind_PS.csv", game)
opponent_strategies = [random_strategy]
efr_strategies = ['Blind_Action', "Blind_CF", "Blind_PS", "Informed_Action", "Informed_CF", "Informed_CFPS", "CSPS", "TIPS"]
opponent_names = ['Random', "MCCFR_low", "MCCFR_med", "MCCFR_high", "MCCFR_higher"]

#Add EFR opponents
for strat in efr_strategies:
    opponent_strategies.append(StoreTabularPolicy.load_tabular_policy("Policy/"+strat+".csv", game))
    opponent_names.append(strat)

header = ['EFR Strategy', 'Opponent Strategy', 'EFR PLayer', "Expected Game Value"]
ev_data = []

for opponentIndex in range(len(opponent_strategies)):
    for strategy in efr_strategies:
        for player_num in range(2):
            data = [strategy, opponent_names[opponentIndex], str(player_num)]
            print(compute_EV(game,opponent_strategies[opponentIndex],player_num, "Policy/"+strategy+".csv")[player_num])
            data.append(compute_EV(game,opponent_strategies[opponentIndex],player_num, "Policy/"+strategy+".csv")[player_num])
            ev_data.append(data)
complete_data = pd.DataFrame(ev_data, columns=header)
complete_data.to_csv('Opponent_EV.csv', index=False)

