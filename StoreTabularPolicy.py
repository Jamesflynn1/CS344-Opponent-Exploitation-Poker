import csv

import pyspiel
from open_spiel.python import policy



def load_tabular_policy(filepath, game):
    stored_policy = policy.TabularPolicy(game)
    with open(filepath) as policy_file:
        try:
            csv_reader = csv.reader(policy_file, delimiter=',')
        except:
            print("Couldn't find policy")
            return
        for row in csv_reader:
            info_state_str = row[0]
            state_policy = stored_policy.policy_for_key(info_state_str)
            for action_entry in range (1, len(row)):
                action = int(row[action_entry].split(";")[0])
                value = float(row[action_entry].split(";")[1])
                state_policy[action] = value
    return stored_policy

def save_tabular_policy(filepath, policy):
    policy_dict = policy.to_dict()
    with open(filepath, mode='w+') as policy_file:
        policy_file = csv.writer(policy_file, delimiter=',')
        for info_state_str in list(policy_dict.keys()):
            row = []
            state_policy = policy.policy_for_key(info_state_str)
            row.append(info_state_str)
            for action in range(len(state_policy)):
                row.append(str(action)+";"+str(state_policy[action]))
            policy_file.writerow(row)

